# Generate Weil sequence
# https://www.insidegnss.com/auto/sepoct11-wp.pdf
# %%
import math
from tqdm import tqdm
import numpy as np
from scipy.signal import max_len_seq
# %%
# From IS-GPS-800G Table 6.2-1
# This array takes several minutes to calculate. So just copying it from the standard.
legendre_10223_str = """
    17362522 73143031 34741742 76027406 65416740 15370031 77300273 35501333
    33151247 33675050 47166774 40402617 35343610 40736426 77150400 56347466
    36245544 14235136 76277137 54514403 43761771 63757753 10410242 61624734
    77466552 35205643 12012635 73526361 37265704 13025043 45322543 37432162
    77326143 45150310 05107037 54166771 27703137 74542727 45031447 01004237
    12273570 15652657 22772517 65350474 54114016 02230023 20076271 43647711
    27674121 21171660 67446011 57711024 16221254 31322707 26275421 22673214
    65366373 57740342 14365061 14114237 11167632 73150266 77371036 30177233
    25366663 22574225 43541714 10240442 53145643 74102765 57024573 71772406
    73772650 76463525 67435700 63247125 11061276 57410334 52564011 40607536
    04327166 77477642 17073116 33210534 72332534 73060727 31146544 03037511
    17021645 12501762 10306066 12006074 72004335 32633605 12752101 77244646
    23672177 52462044 62541736 55313003 31650153 60021445 05753416 14426340
    05322262 06715512 66162462 33665124 21726377 05106214 60236326 66705713
    71543563 60352627 45756540 02651270 47406731 54412044 45121407 10322724
    46160571 67206661 66664554 12216361 25747536 16022770 34124777 66602424
    61062733 61612036 30215575 12627147 12750552 45761540 04527340 51131031
    06640501 15211265 25500450 63377157 17261023 11076665 34472726 21025171
    74373774 73231401 75214170 25043117 23754267 57744043 30662311 74563144
    54565162 56632723 55751254 50347551 46734531 02104647 52536041 77042562
    43106463 74452331 75274175 27330230 55640164 64561770 36243256 11562553
    24303426 33067553 26661362 13762326 24040503 63155340 12740027 37165604
    57241060 07610146 14730412 05773230 56406443 62032322 04720203 22533503
    24700043 52247706 66633026 37301354 54237744 72145047 67666353 11734360
    60753126 22576527 46710330 70430313 72734542 05642563 45063606 34401276
    24172144 12454475 20105020 47510306 03073516 25121772 07415233 22755042
    51042432 22312072 13633455 47060431 33320762 33017222 26357161 44542302
    72172633 32353566 53564413 22324741 72007265 30642163 71636641 57365677
    24154552 75472075 30127754 31703165 43053505 73454212 02636356 16236611
    41250053 31262417 17034206 62431101 01565472 15400334 54427620 31362311
    11601532 43577615 23642253 23737215 73232373 03551750 56322005 72756214
    71476701 77167520 55705060 21377412 77424463 03657575 31233002 73027111
    22441162 31343635 22453046 70523530 36007055 15077504 56336221 24074124
    06232554 03151663 53053560 07570252 41515673 66254211 46441436 54526404
    43212310 53065054 55463054 06633116 23575400 41134403 20663565 36074724
    07746322 14002034 06065367 31212154 25110166 63367120 60460023 16557645
    25126724 67657511 66366266 57421255 77447005 52456412 61461312 64044736
    30372707 02213167 15353711 00015274 36013370 70241405 27030732 74455111
    07111721 06057071 55213236 61747265 55572754 46211741 56126513 77450405
    41312437 03043446 02605611 11230337 14731665 60031207 35265102 33153071
    12644611 73133225 77431354 70742405 65547377 02476506 23762624 50207453
    15573152 40072103 31515520 07672412 65702312 24235772 14171772 71171636
    73007652 65507360 66640363 75451466 21217162 14252232 14256722 30662160
    73500140 11061235 70241717 46775052 54236740 50127166 65261523 17604341
    05243150 16512002 11752006 02055360 45013674 03505462 53557536 74607443
    45334053 23111025 22320076 30366020 11136462 12301066 60334674 67165034
    73437400 42031025 14722113 27344131 21613226 34527330 75366600 46771541
    17106067 27274101 26601503 46130177 23376333 70774674 54156425 00652013
    20512504 76042132 60335767 61546365 41213454 00263601 26011074 40361665
    76636465 43471220 13072340 23453225 43565362 75605120 27031242 04312772
    63505724 32451140 14215307 13536756 62400403 06007003 43754654 40260130
    10264334 75445530 31141430 57756460 11350217 56703424 20713757 54011061
    56564102 21526462 22227644 22137620 06376024 77410745 11741370 13407414
    26363462 13253020
"""
legendre_10223_str = "".join(legendre_10223_str.split()) # Strip whitespace
legendre_10223 = int(legendre_10223_str, 8) # Convert to number
# Convert to binary array skipping '0b' but adding leading zero
leg10223 = '0' + bin(legendre_10223)[2:]
legendre_10223 = np.fromiter(bytes(leg10223, "utf-8"), dtype=int) == ord('1') # Convert to a binary array
# %%


def ranging_code(w, p):
    weil = np.logical_xor(
        legendre_10223,
        np.roll(legendre_10223, -w)
    )
    expansion = np.array([
        False, True, True, False, True, False, False
    ])
    return np.concatenate((
        weil[:p-1],
        expansion,
        weil[p-1:]
    ))

prn_to_ranging = {
    # From Table 3.2-2
    1: (5111, 412, 0o5752067, 0o20173742, 5097, 181, 0o77001425, 0o52231646),
    2: (5109, 161, 0o70146401, 0o35437154, 5110, 359, 0o23342754, 0o46703351),
    3: (5108, 1, 0o32066222, 0o161056, 5079, 72, 0o30523404, 0o145161),
    4: (5106, 303, 0o72125121, 0o71435437, 4403, 1110, 0o3777635, 0o11261273),
    5: (5103, 207, 0o42323273, 0o15035661, 4121, 1480, 0o10505640, 0o71364603),
    6: (5101, 4971, 0o1650642, 0o32606570, 5043, 5034, 0o42134174, 0o55012662),
    7: (5100, 4496, 0o21303446, 0o3475644, 5042, 4622, 0o471711, 0o30373701),
    8: (5098, 5, 0o35504263, 0o11316575, 5104, 1, 0o32237045, 0o7706523),
    9: (5095, 4557, 0o66434311, 0o23047575, 4940, 4547, 0o16004766, 0o71741157),
    10: (5094, 485, 0o52631623, 0o7355246, 5035, 826, 0o66234727, 0o42347523),
    11: (5093, 253, 0o4733076, 0o15210113, 4372, 6284, 0o3755314, 0o12746122),
    12: (5091, 4676, 0o50352603, 0o72643606, 5064, 4195, 0o20604227, 0o34634113),
    13: (5090, 1, 0o32026612, 0o63457333, 5084, 368, 0o25477233, 0o47555063),
    14: (5081, 66, 0o7476042, 0o46623624, 5048, 1, 0o32025443, 0o1221116),
    15: (5080, 4485, 0o22210746, 0o35467322, 4950, 4796, 0o35503400, 0o37125437),
    16: (5069, 282, 0o30706376, 0o70116567, 5019, 523, 0o70504407, 0o32203664),
    17: (5068, 193, 0o75764610, 0o62731643, 5076, 151, 0o26163421, 0o62162634),
    18: (5054, 5211, 0o73202225, 0o14040613, 3736, 713, 0o52176727, 0o35012616),
    19: (5044, 729, 0o47227426, 0o7750525, 4993, 9850, 0o72557314, 0o437232),
    20: (5027, 4848, 0o16064126, 0o37171211, 5060, 5734, 0o62043206, 0o32130365),
    21: (5026, 982, 0o66415734, 0o1302134, 5061, 34, 0o7151343, 0o51515733),
    22: (5014, 5955, 0o27600270, 0o37672235, 5096, 6142, 0o16027175, 0o73662313),
    23: (5004, 9805, 0o66101627, 0o32201230, 4983, 190, 0o26267340, 0o55416712),
    24: (4980, 670, 0o17717055, 0o37437553, 4783, 644, 0o36272365, 0o22550142),
    25: (4915, 464, 0o47500232, 0o23310544, 4991, 467, 0o67707677, 0o31506062),
    26: (4909, 29, 0o52057615, 0o7152415, 4815, 5384, 0o7760374, 0o44603344),
    27: (4893, 429, 0o76153566, 0o2571041, 4443, 801, 0o73633310, 0o5252052),
    28: (4885, 394, 0o22444670, 0o52270664, 4769, 594, 0o30401257, 0o70603616),
    29: (4832, 616, 0o62330044, 0o61317104, 4879, 4450, 0o72606251, 0o51643216),
    30: (4824, 9457, 0o13674337, 0o43137330, 4894, 9437, 0o37370402, 0o30417163),
    31: (4591, 4429, 0o60635146, 0o20336467, 4985, 4307, 0o74255661, 0o20074570),
    32: (3706, 4771, 0o73527653, 0o40745656, 5056, 5906, 0o10171147, 0o26204176),
    33: (5092, 365, 0o63772350, 0o50272475, 4921, 378, 0o12242515, 0o7105451),
    34: (4986, 9705, 0o33564215, 0o75604301, 5036, 9448, 0o17426100, 0o31062227),
    35: (4965, 9489, 0o52236055, 0o52550266, 4812, 9432, 0o75647756, 0o36516016),
    36: (4920, 4193, 0o64506521, 0o15334214, 4838, 5849, 0o71265340, 0o7641474),
    37: (4917, 9947, 0o73561133, 0o53445703, 4855, 5547, 0o74355073, 0o35065520),
    38: (4858, 824, 0o12647121, 0o71136024, 4904, 9546, 0o45253014, 0o3155010),
    39: (4847, 864, 0o16640265, 0o1607455, 4753, 9132, 0o12452274, 0o34041736),
    40: (4790, 347, 0o11161337, 0o73467421, 4483, 403, 0o7011213, 0o20162561),
    41: (4770, 677, 0o22055260, 0o54372454, 4942, 3766, 0o35143750, 0o1603755),
    42: (4318, 6544, 0o11546064, 0o11526534, 4813, 3, 0o26442600, 0o40541055),
    43: (4126, 6312, 0o24765004, 0o16522173, 4957, 684, 0o67214123, 0o64750626),
    44: (3961, 9804, 0o14042504, 0o74053703, 4618, 9711, 0o62274362, 0o72550016),
    45: (3790, 278, 0o53512265, 0o52211303, 4669, 333, 0o23371051, 0o36130364),
    46: (4911, 9461, 0o15317006, 0o72655147, 4969, 6124, 0o25121057, 0o25236175),
    47: (4881, 444, 0o16151224, 0o1212152, 5031, 10216, 0o20362622, 0o43732204),
    48: (4827, 4839, 0o67454561, 0o10410122, 5038, 4251, 0o33050463, 0o2316015),
    49: (4795, 4144, 0o47542743, 0o22473073, 4740, 9893, 0o65334051, 0o212370),
    50: (4789, 9875, 0o65057230, 0o63145220, 4073, 9884, 0o65523456, 0o35163655),
    51: (4725, 197, 0o77415771, 0o65734110, 4843, 4627, 0o53741004, 0o33771603),
    52: (4675, 1156, 0o75364651, 0o25167435, 4979, 4449, 0o66360341, 0o41161255),
    53: (4539, 4674, 0o75664330, 0o17524136, 4867, 9798, 0o34421651, 0o76257261),
    54: (4535, 10035, 0o44600202, 0o47064764, 4964, 985, 0o4530741, 0o33512503),
    55: (4458, 4504, 0o23211425, 0o14016156, 5025, 4272, 0o12621031, 0o16237466),
    56: (4197, 5, 0o51504740, 0o11723025, 4579, 126, 0o62330452, 0o24120336),
    57: (4096, 9937, 0o47712554, 0o76760325, 4390, 10024, 0o67510404, 0o11103121),
    58: (3484, 430, 0o67325233, 0o4724615, 4763, 434, 0o726605, 0o36467526),
    59: (3481, 5, 0o61517015, 0o72504743, 4612, 1029, 0o200154, 0o66444010),
    60: (3393, 355, 0o43217554, 0o51215201, 4784, 561, 0o37533004, 0o70455364),
    61: (3175, 909, 0o52520062, 0o630473, 3716, 289, 0o73771510, 0o26726105),
    62: (2360, 1622, 0o77073716, 0o71217605, 4703, 638, 0o44071707, 0o63663333),
    63: (1852, 6284, 0o56350460, 0o50200707, 4851, 4353, 0o34665654, 0o42142704),
    64: (5065, 9429, 0o2447300, 0o44305246, 4955, 9899, 0o64477030, 0o4573761),
    65: (5063, 77, 0o71725674, 0o460475, 5018, 4629, 0o15665564, 0o3677302),
    66: (5055, 932, 0o25453304, 0o5674447, 4642, 669, 0o44273171, 0o47762107),
    67: (5012, 5973, 0o14574042, 0o36357263, 4840, 4378, 0o245661, 0o71201242),
    68: (4981, 377, 0o74661664, 0o42702346, 4961, 4528, 0o5562715, 0o61227172),
    69: (4952, 10000, 0o23576062, 0o32521054, 4263, 9718, 0o7374424, 0o7244400),
    70: (4934, 951, 0o41542650, 0o42476101, 5011, 5485, 0o67651746, 0o1611101),
    71: (4932, 6212, 0o1104546, 0o61116204, 4922, 6222, 0o67552565, 0o23566142),
    72: (4786, 686, 0o33434042, 0o4262600, 4317, 672, 0o25244755, 0o52125666),
    73: (4762, 9352, 0o21774465, 0o1545263, 3636, 1275, 0o55656370, 0o55064114),
    74: (4640, 5999, 0o40262622, 0o40375205, 4884, 6083, 0o30605453, 0o33642702),
    75: (4601, 9912, 0o56142774, 0o40344363, 5041, 5264, 0o61613023, 0o2603370),
    76: (4563, 9620, 0o43202027, 0o50372155, 4912, 10167, 0o71661742, 0o50247376),
    77: (4388, 635, 0o4516115, 0o33621000, 4504, 1085, 0o50524332, 0o326425),
    78: (3820, 4951, 0o74662364, 0o36551057, 4617, 194, 0o10511616, 0o63512437),
    79: (3687, 5453, 0o52076567, 0o27766445, 4633, 5012, 0o24037773, 0o10407511),
    80: (5052, 4658, 0o47474451, 0o52411766, 4566, 4938, 0o63337466, 0o22042777),
    81: (5051, 4800, 0o2211543, 0o33572343, 4702, 9356, 0o43413024, 0o27047165),
    82: (5047, 59, 0o23163471, 0o56266077, 4758, 5057, 0o22004634, 0o43767732),
    83: (5039, 318, 0o25176610, 0o31141052, 4860, 866, 0o16354567, 0o2577001),
    84: (5015, 571, 0o14457237, 0o42211412, 3962, 2, 0o55154652, 0o45652666),
    85: (5005, 565, 0o17254300, 0o51377401, 4882, 204, 0o77375306, 0o37351344),
    86: (4984, 9947, 0o17501057, 0o6740644, 4467, 9808, 0o62125702 56325175),
    87: (4975, 4654, 0o50364001, 0o15746533, 4730, 4365, 0o60360471, 0o34116400),
    88: (4974, 148, 0o45555767, 0o10015665, 4910, 162, 0o67160364, 0o23450053),
    89: (4972, 3929, 0o107361, 0o73402571, 4684, 367, 0o17351730, 0o27646414),
    90: (4962, 293, 0o50312164, 0o77323304, 4908, 201, 0o44400061, 0o15313636),
    91: (4913, 178, 0o20514052, 0o15263715, 4759, 18, 0o7046264, 0o32022604),
    92: (4907, 10142, 0o3627757, 0o10233327, 4880, 251, 0o26443275, 0o16273455),
    93: (4903, 9683, 0o3102361, 0o57310034, 4095, 10167, 0o42362501, 0o21406562),
    94: (4833, 137, 0o7637647, 0o77143271, 4971, 21, 0o61464206, 0o63177644),
    95: (4778, 565, 0o72757527, 0o43465043, 4873, 685, 0o304675, 0o13677122),
    96: (4721, 35, 0o74713660, 0o574365, 4561, 92, 0o1474411, 0o43477217),
    97: (4661, 5949, 0o47776235, 0o44401766, 4588, 1057, 0o43152275, 0o60145564),
    98: (4660, 2, 0o15011643, 0o34576343, 4773, 3, 0o66447224, 0o62047761),
    99: (4655, 5982, 0o70055175, 0o31725507, 4997, 5756, 0o32506067, 0o66757271),
    100: (4623, 825, 0o13300130, 0o67312706, 4583, 14, 0o27071504, 0o74435373),
    101: (4590, 9614, 0o51731304, 0o46621603, 4900, 9979, 0o75221557, 0o77647321),
    102: (4548, 9790, 0o17630510, 0o64345411, 4574, 9569, 0o3454571, 0o17534646),
    103: (4461, 5613, 0o63203440, 0o61602741, 4629, 515, 0o72272760, 0o7321605),
    104: (4442, 764, 0o14332223, 0o54253415, 4676, 753, 0o31706274, 0o67422013),
    105: (4347, 660, 0o76103604, 0o43302054, 4181, 1181, 0o42747572, 0o6767032),
    106: (4259, 4870, 0o37324636, 0o3453741, 5057, 9442, 0o63335441, 0o61365314),
    107: (4256, 4950, 0o26603302, 0o52233056, 4944 669, 0o21777623, 0o41010744),
    108: (4166, 4881, 0o2757505, 0o43130175, 4401, 4834, 0o51543753, 0o53655472),
    109: (4155, 1151, 0o55462247, 0o12241054, 4586, 541, 0o21406443, 0o65430511),
    110: (4109, 9977, 0o40577461, 0o75365233, 4699, 9933, 0o61270463, 0o50672434),
    111: (4100, 5122, 0o17433077, 0o21435116, 3676, 6683, 0o7270323, 0o34014107),
    112: (4023, 10074, 0o4115442, 0o40670365, 4387, 4828, 0o23660721, 0o3066030),
    113: (3998, 4832, 0o13154727, 0o64265263, 4866, 9710, 0o77637043, 0o61651100),
    114: (3979, 77, 0o77057317, 0o30074057, 4926, 10170, 0o12433652, 0o5570472),
    115: (3903, 4698, 0o1513425, 0o75121550, 4657, 9629, 0o5304706, 0o1521516),
    116: (3568, 1002, 0o5132465, 0o54744641, 4477, 260, 0o77452705, 0o67160335),
    117: (5088, 5549, 0o50104501, 0o5312042, 4359, 86, 0o52354405, 0o3517044),
    118: (5050, 9606, 0o60523106, 0o43103551, 4673, 5544, 0o6041146, 0o34634123),
    119: (5020, 9228, 0o22246740, 0o51372531, 4258, 923, 0o76175470, 0o17153350),
    120: (4990, 604, 0o12364050, 0o42135401, 4447, 257, 0o15006176, 0o53272671),
    121: (4982, 4678, 0o32514207, 0o30171775, 4570, 507, 0o7111630, 0o37064353),
    122: (4966, 4854, 0o67423664, 0o10455535, 4486, 4572, 0o21205723, 0o20146433),
    123: (4949, 4122, 0o77266167, 0o1324227, 4362, 4491, 0o72653641, 0o14613666),
    124: (4947, 9471, 0o46461421, 0o31664661, 4481, 341, 0o10436256, 0o15435310),
    125: (4937, 5026, 0o44731317, 0o5002237, 4322, 130, 0o52721673, 0o44561325),
    126: (4935, 272, 0o40352277, 0o30601263, 4668, 79, 0o30153343, 0o41722542),
    127: (4906, 1027, 0o60334000, 0o52663163, 3967, 1142, 0o46031334, 0o33221302),
    128: (4901, 317, 0o31414460, 0o42263623, 4374, 448, 0o52705400, 0o15637431),
    129: (4872, 691, 0o21565451, 0o53041061, 4553, 875, 0o71133426, 0o57572470),
    130: (4865, 509, 0o16330346, 0o66052070, 4641, 555, 0o43512313, 0o35007473),
    131: (4863, 9708, 0o32652065, 0o4013232, 4215, 1272, 0o77673747, 0o16425373),
    132: (4818, 5033, 0o26514154, 0o67750663, 3853, 5198, 0o15633060, 0o34372463),
    133: (4785, 9938, 0o34231746, 0o54647730, 4787, 9529, 0o24027652, 0o25230460),
    134: (4781, 4314, 0o76662461, 0o15133614, 4266, 4459, 0o22453455, 0o53327223),
    135: (4776, 10140, 0o47747731, 0o1314434, 4199, 10019, 0o1620441, 0o1513007),
    136: (4775, 4790, 0o2344033, 0o56230626, 4545, 9353, 0o24652730, 0o64542663),
    137: (4754, 9823, 0o66173226, 0o45676614, 4208, 9780, 0o53141737, 0o53274351),
    138: (4696, 6093, 0o73016727, 0o47111161, 4485, 375, 0o71125036, 0o46715625),
    139: (4690, 469, 0o77312770, 0o52710401, 3714, 503, 0o7542336, 0o54164205),
    140: (4658, 1215, 0o51646142, 0o36536254, 4407, 4507, 0o16114445, 0o53416247),
    141: (4607, 799, 0o56016363, 0o2567340, 4182, 875, 0o46740433, 0o20023005),
    142: (4599, 756, 0o42604563, 0o61470650, 4203, 1246, 0o55271356, 0o44253547),
    143: (4596, 9994, 0o31351337, 0o54031347, 3788, 1, 0o32216472, 0o3043444),
    144: (4530, 4843, 0o27106364, 0o22157757, 4471, 4534, 0o23356330, 0o30510313),
    145: (4524, 5271, 0o41653674, 0o34140067, 4691, 8, 0o35551350, 0o10154063),
    146: (4451, 9661, 0o41723426, 0o13666204, 4281, 9549, 0o57761372, 0o33147336),
    147: (4441, 6255, 0o67572676, 0o30653236, 4410, 6240, 0o30253244, 0o15601652),
    148: (4396, 5203, 0o13221317, 0o26243171, 3953, 22, 0o52100453, 0o23705421),
    149: (4340, 203, 0o546077, 0o16413664, 3465, 5652, 0o51034421, 0o41130727),
    150: (4335, 10070, 0o26001221, 0o55366035, 4801, 10069, 0o16015465, 0o71256351),
    151: (4296, 30, 0o25023624, 0o22432004, 4278, 4796, 0o50647656, 0o51262411),
    152: (4267, 103, 0o6170665, 0o13123426, 4546, 4980, 0o12572136, 0o64470526),
    153: (4168, 5692, 0o56716445, 0o52547645, 3779, 27, 0o70330016, 0o56143230),
    154: (4149, 32, 0o42176035, 0o56243100, 4115, 90, 0o15527641, 0o472356),
    155: (4097, 9826, 0o54672466, 0o40035633, 4193, 9788, 0o11434413, 0o53374420),
    156: (4061, 76, 0o30010163, 0o23111613, 3372, 715, 0o16327052, 0o70130674),
    157: (3989, 59, 0o12460454, 0o45324016, 3786, 9720, 0o21517504, 0o71211135),
    158: (3966, 6831, 0o2433231, 0o43266171, 3491, 301, 0o22752764, 0o24514303),
    159: (3789, 958, 0o44262655, 0o33672171, 3812, 5450, 0o21041013, 0o66000624),
    160: (3775, 1471, 0o74466417, 0o45007430, 3594, 5215, 0o30150603, 0o44124121),
    161: (3622, 10070, 0o40534627, 0o47162164, 4028, 13, 0o4373224, 0o72305275),
    162: (3523, 553, 0o77507301, 0o14403627, 3652, 1147, 0o11502362, 0o34315206),
    163: (3515, 5487, 0o77047741, 0o7244501, 4224, 4855, 0o247305, 0o65100431),
    164: (3492, 55, 0o6772006, 0o64545666, 4334, 1190, 0o72427277, 0o30205426),
    165: (3345, 208, 0o40473120, 0o12372447, 3245, 1267, 0o25646343, 0o41567071),
    166: (3235, 645, 0o34300604, 0o13076376, 3921, 1302, 0o56324170, 0o63121546),
    167: (3169, 5268, 0o65107417, 0o40367614, 3840, 1, 0o32142641, 0o65356365),
    168: (3157, 1873, 0o70400121, 0o74416333, 3514, 5007, 0o56004007, 0o55254670),
    169: (3082, 427, 0o25212235, 0o1370063, 2922, 549, 0o75210756, 0o70737175),
    170: (3072, 367, 0o74600422, 0o46656071, 4227, 368, 0o53764644, 0o70767133),
    171: (3032, 1404, 0o12032423, 0o31523361, 3376, 6300, 0o27301136, 0o74626324),
    172: (3030, 5652, 0o13632510, 0o17725050, 3560, 5658, 0o62522732, 0o50344217),
    173: (4582, 5, 0o71510055, 0o60560145, 4989, 4302, 0o64555743, 0o77720230),
    174: (4595, 368, 0o75143230, 0o70762153, 4756, 851, 0o75635153, 0o61374142),
    175: (4068, 451, 0o45520711, 0o63715635, 4624, 4353, 0o65657537, 0o63150674),
    176: (4871, 9595, 0o71255143, 0o33356000, 4446, 9618, 0o67024710, 0o73243704),
    177: (4514, 1030, 0o74432602, 0o60240565, 4174, 9652, 0o33425256, 0o62635540),
    178: (4439, 1324, 0o64502543, 0o37553063, 4551, 1232, 0o27012711, 0o62337332),
    179: (4122, 692, 0o62244257, 0o57024466, 3972, 109, 0o1142615, 0o10746114),
    180: (4948, 9819, 0o56114714, 0o56224523, 4399, 10174, 0o63104766, 0o43352532),
    181: (4774, 4520, 0o20545772, 0o71662723, 4562, 6178, 0o40126774, 0o32603456),
    182: (3923, 9911, 0o34440721, 0o52501713, 3133, 1851, 0o51100156, 0o12547126),
    183: (3411, 278, 0o27113701, 0o32506507, 4157, 1299, 0o23271257, 0o17203343),
    184: (4745, 642, 0o55315473, 0o51205405, 5053, 325, 0o54126675, 0o10756735),
    185: (4195, 6330, 0o3002035, 0o13765021, 4536, 10206, 0o52457352, 0o64624731),
    186: (4897, 5508, 0o22413634, 0o25612410, 5067, 9968, 0o57355463, 0o67422311),
    187: (3047, 1872, 0o50147661, 0o27377757, 3905, 10191, 0o43536147, 0o22501761),
    188: (4185, 5445, 0o36713526, 0o21553277, 3721, 5438, 0o77173403, 0o74416242),
    189: (4354, 10131, 0o67255070, 0o21044121, 3787, 10080, 0o260547, 0o57357212),
    190: (5077, 422, 0o17310715, 0o71430410, 4674, 219, 0o57155443, 0o44305226),
    191: (4042, 4918, 0o20674706, 0o1406234, 3436, 758, 0o77502633, 0o30766330),
    192: (2111, 787, 0o21764400, 0o10264531, 2673, 2140, 0o25162476, 0o67406576),
    193: (4311, 9864, 0o70670250, 0o11640746, 4834, 9753, 0o54420241, 0o43473502),
    194: (5024, 9753, 0o24737373, 0o51661203, 4456, 4799, 0o75476311, 0o32402217),
    195: (4352, 9859, 0o4467202, 0o15610600, 4056, 10126, 0o50612163, 0o43454074),
    196: (4678, 328, 0o2551300, 0o70117174, 3804, 241, 0o77772455, 0o6321507),
    197: (5034, 1, 0o32252546, 0o77615261, 3672, 1245, 0o3320402, 0o22101365),
    198: (5085, 4733, 0o10121331, 0o22447126, 4205, 1274, 0o20225612, 0o67251717),
    199: (3646, 164, 0o10537634, 0o65022442, 3348, 1456, 0o55426411, 0o2047657),
    200: (4868, 135, 0o32014275, 0o41243522, 4152, 9967, 0o70477545, 0o43352227),
    201: (3668, 174, 0o13126037, 0o56605536, 3883, 235, 0o71116442, 0o4471535),
    202: (4211, 132, 0o60700561, 0o13020736, 3473, 512, 0o42077151, 0o62510717),
    203: (2883, 538, 0o75356470, 0o15605531, 3669, 1078, 0o65203721, 0o366214),
    204: (2850, 176, 0o20543613, 0o2371410, 3455, 1078, 0o42436531, 0o32276151),
    205: (2815, 198, 0o33767061, 0o10107642, 2318, 953, 0o21017627, 0o77470652),
    206: (2542, 595, 0o5734074, 0o10115665, 2945, 5647, 0o62667326, 0o72435665),
    207: (2492, 574, 0o36277063, 0o72611614, 2947, 669, 0o56255552, 0o14160206),
    208: (2376, 321, 0o4163243, 0o56150655, 3220, 1311, 0o13413261, 0o64235022),
    209: (2036, 596, 0o71443237, 0o54060273, 4052, 5827, 0o55443510, 0o21663362),
    210: (1920, 491, 0o26113110, 0o12644254, 2953, 15, 0o67734642, 0o20171640),
}

def prn_ranging():
    r = {}
    for prn, v in enumerate(prn_to_ranging):
        r[prn] = (
            ranging_code(v[0], v[1]), # L1Cp
            ranging_code(v[4], v[5])  # L1Cd
        )
    return r

def test_ranging():
    a = np.power(2, np.arange(23, -1, -1))
    for prn, v in prn_to_ranging.items():
        l1cp = ranging_code(v[0], v[1])
        assert(v[2] == np.sum(a[l1cp[:24]]))
        assert(v[3] == np.sum(a[l1cp[-24:]])
        l1cd = ranging_code(v[4], v[5])
        assert(v[6] == np.sum(a[l1cd[:24]]))
        assert(v[7] == np.sum(a[l1cd[-24:]])

prn_to_overlay = {
    # From table 3.2-3
    1: (0o5111, None, 0o3266, None, 0o410),
    2: (0o5421, None, 0o2040, None, 0o3153),
    3: (0o5501, None, 0o1527, None, 0o1767),
    4: (0o5403, None, 0o3307, None, 0o2134),
    5: (0o6417, None, 0o3756, None, 0o3510),
    6: (0o6141, None, 0o3026, None, 0o2260),
    7: (0o6351, None, 0o562, None, 0o2433),
    8: (0o6501, None, 0o420, None, 0o3520),
    9: (0o6205, None, 0o3415, None, 0o2652),
    10: (0o6235, None, 0o337, None, 0o2050),
    11: (0o7751, None, 0o265, None, 0o70),
    12: (0o6623, None, 0o1230, None, 0o1605),
    13: (0o6733, None, 0o2204, None, 0o1247),
    14: (0o7627, None, 0o1440, None, 0o773),
    15: (0o5667, None, 0o2412, None, 0o2377),
    16: (0o5051, None, 0o3516, None, 0o1525),
    17: (0o7665, None, 0o2761, None, 0o1531),
    18: (0o6325, None, 0o3750, None, 0o3540),
    19: (0o4365, None, 0o2701, None, 0o524),
    20: (0o4745, None, 0o1206, None, 0o1035),
    21: (0o7633, None, 0o1544, None, 0o3337),
    22: (0o6747, None, 0o1774, None, 0o176),
    23: (0o4475, None, 0o546, None, 0o244),
    24: (0o4225, None, 0o2213, None, 0o1027),
    25: (0o7063, None, 0o3707, None, 0o1753),
    26: (0o4423, None, 0o2051, None, 0o3502),
    27: (0o6651, None, 0o3650, None, 0o64),
    28: (0o4161, None, 0o1777, None, 0o2275),
    29: (0o7237, None, 0o3203, None, 0o44),
    30: (0o4473, None, 0o1762, None, 0o2777),
    31: (0o5477, None, 0o2100, None, 0o367),
    32: (0o6163, None, 0o571, None, 0o535),
    33: (0o7223, None, 0o3710, None, 0o3776),
    34: (0o6323, None, 0o3535, None, 0o2677),
    35: (0o7125, None, 0o3110, None, 0o102),
    36: (0o7035, None, 0o1426, None, 0o2520),
    37: (0o4341, None, 0o255, None, 0o2444),
    38: (0o4353, None, 0o321, None, 0o3770),
    39: (0o4107, None, 0o3124, None, 0o1517),
    40: (0o5735, None, 0o572, None, 0o1133),
    41: (0o6741, None, 0o1736, None, 0o3754),
    42: (0o7071, None, 0o3306, None, 0o33),
    43: (0o4563, None, 0o1307, None, 0o1170),
    44: (0o5755, None, 0o3763, None, 0o1567),
    45: (0o6127, None, 0o1604, None, 0o3534),
    46: (0o4671, None, 0o1021, None, 0o2515),
    47: (0o4511, None, 0o2624, None, 0o104),
    48: (0o4533, None, 0o406, None, 0o3343),
    49: (0o5357, None, 0o114, None, 0o1510),
    50: (0o5607, None, 0o77, None, 0o2170),
    51: (0o6673, None, 0o3477, None, 0o710),
    52: (0o6153, None, 0o1000, None, 0o3375),
    53: (0o7565, None, 0o3460, None, 0o2650),
    54: (0o7107, None, 0o2607, None, 0o3307),
    55: (0o6211, None, 0o2057, None, 0o2262),
    56: (0o4321, None, 0o3467, None, 0o2161),
    57: (0o7201, None, 0o706, None, 0o2076),
    58: (0o4451, None, 0o2032, None, 0o1200),
    59: (0o5411, None, 0o1464, None, 0o643),
    60: (0o5141, None, 0o520, None, 0o2000),
    61: (0o7041, None, 0o1766, None, 0o3377),
    62: (0o6637, None, 0o3270, None, 0o1605),
    63: (0o4577, None, 0o341, None, 0o1552),
    64: (0o5111, 0o1740, 0o3035, 0o2775, 0o2145),
    65: (0o5111, 0o3664, 0o1557, 0o2333, 0o1656),
    66: (0o5111, 0o1427, 0o237, 0o1610, 0o356),
    67: (0o5111, 0o2627, 0o2527, 0o300, 0o753),
    68: (0o5111, 0o701, 0o3307, 0o3406, 0o3403),
    69: (0o5111, 0o3460, 0o1402, 0o2062, 0o2765),
    70: (0o5111, 0o1373, 0o1225, 0o156, 0o1713),
    71: (0o5111, 0o2540, 0o607, 0o2347, 0o3177),
    72: (0o5111, 0o2004, 0o351, 0o2355, 0o1310),
    73: (0o5111, 0o2274, 0o3724, 0o1550, 0o1203),
    74: (0o5111, 0o1340, 0o1675, 0o535, 0o3267),
    75: (0o5111, 0o602, 0o2625, 0o2027, 0o3240),
    76: (0o5111, 0o2502, 0o1030, 0o3532, 0o2055),
    77: (0o5111, 0o327, 0o1443, 0o1764, 0o1435),
    78: (0o5111, 0o2600, 0o3277, 0o1477, 0o243),
    79: (0o5111, 0o464, 0o1132, 0o1556, 0o736),
    80: (0o5111, 0o3674, 0o572, 0o3306, 0o2671),
    81: (0o5111, 0o3040, 0o1241, 0o2201, 0o322),
    82: (0o5111, 0o1153, 0o535, 0o1466, 0o3716),
    83: (0o5111, 0o747, 0o1366, 0o1421, 0o2742),
    84: (0o5111, 0o1770, 0o41, 0o1731, 0o671),
    85: (0o5111, 0o3772, 0o561, 0o3213, 0o2735),
    86: (0o5111, 0o1731, 0o122, 0o1613, 0o21),
    87: (0o5111, 0o1672, 0o1205, 0o477, 0o631),
    88: (0o5111, 0o1333, 0o3753, 0o2460, 0o3537),
    89: (0o5111, 0o2705, 0o2543, 0o246, 0o3620),
    90: (0o5111, 0o2713, 0o3031, 0o1722, 0o1622),
    91: (0o5111, 0o3562, 0o2260, 0o1702, 0o1173),
    92: (0o5111, 0o3245, 0o3773, 0o536, 0o2673),
    93: (0o5111, 0o3770, 0o3156, 0o626, 0o2737),
    94: (0o5111, 0o3202, 0o2215, 0o1017, 0o3121),
    95: (0o5111, 0o3521, 0o146, 0o3467, 0o1760),
    96: (0o5111, 0o3250, 0o2413, 0o1643, 0o2600),
    97: (0o5111, 0o2117, 0o2564, 0o473, 0o3400),
    98: (0o5111, 0o530, 0o3310, 0o3620, 0o1176),
    99: (0o5111, 0o3021, 0o2267, 0o1246, 0o514),
    100: (0o5421, 0o2511, 0o3120, 0o1431, 0o1644),
    101: (0o5421, 0o1562, 0o64, 0o1506, 0o3554),
    102: (0o5421, 0o1067, 0o1042, 0o25, 0o1161),
    103: (0o5421, 0o424, 0o476, 0o52, 0o333),
    104: (0o5421, 0o3402, 0o1020, 0o2422, 0o1620),
    105: (0o5421, 0o1326, 0o431, 0o1717, 0o2000),
    106: (0o5421, 0o2142, 0o216, 0o2354, 0o2655),
    107: (0o5421, 0o733, 0o2736, 0o2005, 0o320),
    108: (0o5421, 0o504, 0o2527, 0o2023, 0o1103),
    109: (0o5421, 0o1611, 0o2431, 0o3220, 0o3531),
    110: (0o5421, 0o2724, 0o1013, 0o3737, 0o723),
    111: (0o5421, 0o753, 0o524, 0o277, 0o23),
    112: (0o5421, 0o3724, 0o726, 0o3002, 0o2312),
    113: (0o5421, 0o2652, 0o1042, 0o3610, 0o1723),
    114: (0o5421, 0o1743, 0o3362, 0o2421, 0o3065),
    115: (0o5421, 0o13, 0o1364, 0o1377, 0o1565),
    116: (0o5421, 0o3464, 0o3354, 0o730, 0o1211),
    117: (0o5421, 0o2300, 0o623, 0o2523, 0o3610),
    118: (0o5421, 0o1334, 0o145, 0o1271, 0o3602),
    119: (0o5421, 0o2175, 0o214, 0o2361, 0o1155),
    120: (0o5421, 0o2564, 0o223, 0o2747, 0o1166),
    121: (0o5421, 0o3075, 0o151, 0o3124, 0o2207),
    122: (0o5421, 0o3455, 0o2405, 0o1050, 0o2673),
    123: (0o5421, 0o3627, 0o2522, 0o1305, 0o2703),
    124: (0o5421, 0o617, 0o3235, 0o3422, 0o3613),
    125: (0o5421, 0o1324, 0o452, 0o1776, 0o1065),
    126: (0o5421, 0o3506, 0o2617, 0o1311, 0o3270),
    127: (0o5421, 0o2231, 0o1300, 0o3131, 0o40),
    128: (0o5421, 0o1110, 0o1430, 0o520, 0o2541),
    129: (0o5421, 0o1271, 0o773, 0o1502, 0o673),
    130: (0o5421, 0o3740, 0o772, 0o3032, 0o161),
    131: (0o5421, 0o3652, 0o3561, 0o333, 0o143),
    132: (0o5421, 0o1644, 0o607, 0o1043, 0o1040),
    133: (0o5421, 0o3635, 0o420, 0o3215, 0o227),
    134: (0o5421, 0o3436, 0o527, 0o3111, 0o3523),
    135: (0o5421, 0o3076, 0o3770, 0o706, 0o3452),
    136: (0o5421, 0o434, 0o2536, 0o2102, 0o1451),
    137: (0o5421, 0o3340, 0o2233, 0o1173, 0o1677),
    138: (0o5421, 0o54, 0o3366, 0o3332, 0o1650),
    139: (0o5403, 0o2446, 0o3766, 0o1320, 0o712),
    140: (0o5403, 0o25, 0o3554, 0o3571, 0o3305),
    141: (0o5403, 0o150, 0o2060, 0o2130, 0o3603),
    142: (0o5403, 0o2746, 0o2070, 0o736, 0o1607),
    143: (0o5403, 0o2723, 0o713, 0o2030, 0o2301),
    144: (0o5403, 0o2601, 0o3366, 0o1567, 0o420),
    145: (0o5403, 0o3440, 0o3247, 0o607, 0o707),
    146: (0o5403, 0o1312, 0o2776, 0o3464, 0o2331),
    147: (0o5403, 0o544, 0o1244, 0o1700, 0o1705),
    148: (0o5403, 0o2062, 0o2102, 0o160, 0o3566),
    149: (0o5403, 0o176, 0o1712, 0o1664, 0o3165),
    150: (0o5403, 0o3616, 0o1245, 0o2453, 0o2020),
    151: (0o5403, 0o1740, 0o3344, 0o2404, 0o100),
    152: (0o5403, 0o3777, 0o1277, 0o2500, 0o1627),
    153: (0o5403, 0o432, 0o165, 0o557, 0o3170),
    154: (0o5403, 0o2466, 0o2131, 0o557, 0o2200),
    155: (0o5403, 0o1667, 0o3623, 0o2044, 0o2217),
    156: (0o5403, 0o3601, 0o141, 0o3740, 0o3133),
    157: (0o5403, 0o2706, 0o421, 0o2327, 0o2340),
    158: (0o5403, 0o2022, 0o3032, 0o1010, 0o1337),
    159: (0o5403, 0o1363, 0o2065, 0o3306, 0o3741),
    160: (0o5403, 0o2331, 0o3024, 0o1315, 0o3215),
    161: (0o5403, 0o3556, 0o2663, 0o1335, 0o3617),
    162: (0o5403, 0o2205, 0o2274, 0o71, 0o3034),
    163: (0o5403, 0o3734, 0o2114, 0o1620, 0o1473),
    164: (0o5403, 0o2115, 0o1664, 0o3771, 0o63),
    165: (0o5403, 0o10, 0o413, 0o403, 0o1102),
    166: (0o5403, 0o2140, 0o1512, 0o3452, 0o2330),
    167: (0o5403, 0o3136, 0o135, 0o3003, 0o2520),
    168: (0o5403, 0o272, 0o2737, 0o2545, 0o1077),
    169: (0o5403, 0o3264, 0o1015, 0o2271, 0o1304),
    170: (0o5403, 0o2017, 0o1075, 0o3062, 0o1061),
    171: (0o5403, 0o2505, 0o1255, 0o3750, 0o1741),
    172: (0o5403, 0o3532, 0o3473, 0o141, 0o1774),
    173: (0o5403, 0o647, 0o2716, 0o2151, 0o2374),
    174: (0o5403, 0o1542, 0o101, 0o1443, 0o473),
    175: (0o5403, 0o2154, 0o1105, 0o3051, 0o713),
    176: (0o5403, 0o3734, 0o1407, 0o2333, 0o3773),
    177: (0o5403, 0o2621, 0o3407, 0o1226, 0o321),
    178: (0o5403, 0o2711, 0o1046, 0o3757, 0o2530),
    179: (0o5403, 0o217, 0o3237, 0o3020, 0o267),
    180: (0o5403, 0o3503, 0o154, 0o3457, 0o3763),
    181: (0o5403, 0o3457, 0o3010, 0o447, 0o570),
    182: (0o5403, 0o3750, 0o2245, 0o1515, 0o2742),
    183: (0o5403, 0o2525, 0o2051, 0o574, 0o1142),
    184: (0o5403, 0o113, 0o2144, 0o2057, 0o1135),
    185: (0o5403, 0o265, 0o1743, 0o1526, 0o1456),
    186: (0o5403, 0o1711, 0o2511, 0o3200, 0o1717),
    187: (0o5403, 0o552, 0o3410, 0o3142, 0o3556),
    188: (0o5403, 0o675, 0o1414, 0o1261, 0o1440),
    189: (0o5403, 0o1706, 0o1275, 0o573, 0o2600),
    190: (0o5403, 0o3513, 0o2257, 0o1744, 0o1676),
    191: (0o5403, 0o1135, 0o2331, 0o3204, 0o2226),
    192: (0o5403, 0o566, 0o276, 0o710, 0o231),
    193: (0o5403, 0o500, 0o3261, 0o3761, 0o1676),
    194: (0o5403, 0o254, 0o1760, 0o1534, 0o1620),
    195: (0o5403, 0o3445, 0o430, 0o3075, 0o2340),
    196: (0o5403, 0o2542, 0o3477, 0o1135, 0o3477),
    197: (0o5403, 0o1257, 0o1676, 0o421, 0o3241),
    198: (0o6501, 0o211, 0o1636, 0o1427, 0o3011),
    199: (0o6501, 0o534, 0o2411, 0o2125, 0o674),
    200: (0o6501, 0o1420, 0o1473, 0o53, 0o1746),
    201: (0o6501, 0o3401, 0o2266, 0o1667, 0o1110),
    202: (0o6501, 0o714, 0o2104, 0o2610, 0o1415),
    203: (0o6501, 0o613, 0o2070, 0o2663, 0o2627),
    204: (0o6501, 0o2475, 0o1766, 0o3313, 0o2471),
    205: (0o6501, 0o2572, 0o711, 0o2263, 0o57),
    206: (0o6501, 0o3265, 0o2533, 0o1756, 0o3364),
    207: (0o6501, 0o1250, 0o353, 0o1103, 0o1762),
    208: (0o6501, 0o1711, 0o1744, 0o55, 0o2317),
    209: (0o6501, 0o2704, 0o53, 0o2757, 0o755),
    210: (0o6501, 0o135, 0o2222, 0o2317, 0o1145),
}
#%%
test_ranging()
#%%
def overlay_code(s1_poly):
    # TODO: Convert s1_poly to taps list
    max_len_seq(10, taps=[7])[0]
    # TODO: Implement s2

def prn_overlay():
    r = {}
    for prn, v in enumerate(prn_to_overlay):
        r[prn] = overlay_code(v[0], v[1], v[2])
    return r
